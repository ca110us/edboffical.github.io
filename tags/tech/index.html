<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>tech - callous' blog</title><meta name=keywords content><meta name=description content="callous' blog"><meta name=author content="callous"><link rel=canonical href=https://callous.cn/tags/tech/><link href=https://callous.cn/assets/css/stylesheet.min.595f5ecef354f9eb94e43d831cd360dcf8b7727542e731c55a7875c9e94a9577.css integrity="sha256-WV9ezvNU+euU5D2DHNNg3Pi3cnVC5zHFWnh1yelKlXc=" rel="preload stylesheet" as=style><link rel=manifest href=https://callous.cn/site.webmanifest><link rel=icon href=https://callous.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://callous.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://callous.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://callous.cn/apple-touch-icon.png><link rel=mask-icon href=https://callous.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.78.1"><link rel=alternate type=application/rss+xml href=https://callous.cn/tags/tech/index.xml><meta property="og:title" content="tech"><meta property="og:description" content="callous' blog"><meta property="og:type" content="website"><meta property="og:url" content="https://callous.cn/tags/tech/"><meta property="og:updated_time" content="2021-06-03T17:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="tech"><meta name=twitter:description content="callous' blog"></head><body class=list id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://callous.cn accesskey=h>callous' blog</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://callous.cn/archives/><span>Archives</span></a></li><li><a href=https://callous.cn/tags/><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>tech</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>ä¸€æ¬¡ lua è™šæ‹Ÿæœºå †æ ˆæº¢å‡ºæ’æŸ¥</h2></header><section class=entry-content><p>èµ·å›  è¿™ä¸€æ¬¡çš„é—®é¢˜å‡ºç°åœ¨æˆ‘å¼€å‘çš„å®‰å…¨ç³»ç»Ÿçš„ agent ä¸­ï¼Œåœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œæµ‹è¯•åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¿˜ç®—å¹¸è¿ğŸ˜… åœ¨å†…ç½‘æµ‹è¯•ç¯å¢ƒä¸­ï¼Œagent ä¸€ç›´éƒ½æ²¡å‡ºç°é—®é¢˜ï¼Œç›´åˆ°è¿è¡Œäº”å…­å¤©åï¼Œçªç„¶å‘ç° lua è™šæ‹Ÿæœºå´©æºƒäº†â€¦
æ—¥å¿—åˆ†æ {"level":"error","ts":"2021-05-31 19:50:27.023","caller":"workers/luaworker.go:132","msg":"call run func failed","error":"/data/dep/agent/lua/utils.lua:38: registry overflow\nstack traceback:\n\t[G]: in function 'gsub'\n\t/data/dep/agent/lua/utils.lua:38: in function 'split'\n\tlua/port.lua:42: in function 'inspect'\n\tlua/port.lua:21: in main chunk\n\t[G]: ?","lua":"port.lua"} {"level":"error","ts":"2021-05-31 19:51:27.104","caller":"workers/luaworker.go:132","msg":"call run func failed","error":"/data/dep/agent/lua/utils.lua:38: registry overflow\nstack traceback:\n\t[G]: in function 'gsub'\n\t/data/dep/agent/lua/utils.lua:38: in function 'split'\n\tlua/port.lua:42: in function 'inspect'\n\tlua/port.lua:21: in main chunk\n\t[G]: ?","lua":"port.lua"} {"level":"error","ts":"2021-05-31 19:53:27.296","caller":"workers/luaworker.go:132","msg":"call run func failed","error":"/data/dep/agent/lua/utils.lua:38: registry overflow\nstack traceback:\n\t[G]: in function 'gsub'\n\t/data/dep/agent/lua/utils.lua:38: in function 'split'\n\tlua/port.lua:42: in function 'inspect'\n\tlua/port.lua:21: in main chunk\n\t[G]: ?...</p></section><footer class=entry-footer>June 3, 2021&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;callous</footer><a class=entry-link aria-label="post link to ä¸€æ¬¡ lua è™šæ‹Ÿæœºå †æ ˆæº¢å‡ºæ’æŸ¥" href=https://callous.cn/blog/tech/registry/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>è®°å½•ä¸€æ¬¡æ¸¸æˆæœåŠ¡ oom æŠ¢æ•‘</h2></header><section class=entry-content><p>èµ·å›  åŸæœ¬æ„‰å¿«çš„å‘¨æ—¥æ™šä¸Šï¼Œçªç„¶æœ‰å®¢æœéƒ¨é—¨çš„å¦¹å­åœ¨ç¾¤é‡Œè¯´æ¸¸æˆæŒ‚äº†ï¼è¿›ä¸å»äº†ï¼è¿˜æœ‰ä¸€å †æˆ¿é—´ä¸å­˜åœ¨çš„é—®é¢˜ï¼
å…ˆè¯´ä¸‹è¿™ä¸ªæŒ‚æ‰çš„æ¸¸æˆï¼Œæ˜¯ä»åˆ«çš„éƒ¨é—¨æ¥æ‰‹è¿‡æ¥çš„ï¼ŒåŸç­äººé©¬åŸºæœ¬éƒ½ç¦»èŒäº†ï¼Œç•™ä¸‹ä¸€å †æ‚ä¹±çš„èµ„æ–™ï¼Œgame æœåŠ¡æ˜¯ç”¨ c++ å†™çš„ã€‚
è§£æ•‘ç©å®¶ å› ä¸ºäº‹æƒ…å‡ºå¾—æ¯”è¾ƒæ€¥ï¼Œè€Œä¸”å¯¼è‡´äº†å¤§è§„æ¨¡çš„ç©å®¶ä¸èƒ½ç™»å½•æ¸¸æˆï¼Œæ‰€ä»¥é¢†å¯¼çš„é¦–å…ˆè¦æ±‚æ˜¯è§£æ•‘ç©å®¶ã€‚å•ä»ç°è±¡ä¸Šåˆ†æï¼Œå¤§è‡´çŒœæµ‹æ˜¯æŸäº›åŸå› å¯¼è‡´çš„ game æœåŠ¡å´©æºƒæˆ–è€…å¤±å»å“åº”ï¼Œå¯¼è‡´ç©å®¶æ— æ³•è¿›å…¥æˆ¿é—´ã€‚ç©å®¶çš„ room ä¿¡æ¯åº”è¯¥ä¼šå­˜åœ¨ç¼“å­˜å½“ä¸­ã€‚å¤§æ¦‚çœ‹äº†ä¸‹ä»£ç ï¼Œå®šä½åˆ°å…³é”®ä½ç½®ï¼Œè¿™é‡Œè´´ä¸€ä¸‹éƒ¨åˆ†ä»£ç ï¼š
è¿™é‡Œä¸å¾—ä¸åæ§½ä¸€ä¸‹ï¼Œæ—¢ç„¶ Enter æˆ¿é—´ä¸æˆåŠŸéƒ½ä¼š Remove æ‰è¿™ä¸ªç¼“å­˜ï¼Œåœ¨æˆ¿é—´ä¸å­˜åœ¨çš„æ—¶å€™ç«Ÿç„¶ä¸åšå¤„ç†ï¼Œç›´æ¥è¿”å›ã€‚å¦å¤–ï¼Œæ›´ä¸èƒ½ç†è§£çš„æ˜¯é‡å¯æœåŠ¡ä¹Ÿä¸ä¼šåˆ é™¤è¿™ä¸ªç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ game å› ä¸ºæ•…éšœå´©æºƒæ‰çš„è¯ï¼Œè¿™é‡Œçš„ç©å®¶æ°¸è¿œéƒ½ä¼šæç¤º â€œæˆ¿é—´ä¸å­˜åœ¨â€ã€‚
ç°åœ¨çŸ¥é“äº†ï¼Œç©å®¶çš„ room ç¼“å­˜åœ¨ memcache é‡Œï¼Œåªè¦æ¸…é™¤æ‰è¿™äº›å¤±æ•ˆçš„ keyï¼Œå°±èƒ½è§£æ”¾è¿™äº›ç©å®¶ã€‚ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œä»…å‡­ key çš„ value æ— æ³•åˆ¤æ–­å‡ºè¿™ä¸ªç©å®¶çš„ room æ˜¯å¦å¤±æ•ˆäº†ã€‚äºæ˜¯åˆå»çœ‹ä»£ç ï¼Œæœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯å¸¦è¿™ä¸ª key å‰ç¼€çš„é”®å€¼å…¨éƒ¨æ¸…é™¤ï¼Œè™½ç„¶è¿™æ ·ä¼šå¯¹æ­£å¸¸æ¸¸æˆçš„ç©å®¶æœ‰ç‚¹å°å½±å“ï¼Œä½†ä¹Ÿæ˜¯æ€»ç»“äº†è¯¸å¤šæ–¹æ¡ˆä¸­å½±å“æœ€å°çš„æ–¹æ¡ˆï¼Œä¹Ÿå¹¸äºä»–ä¸å®Œå…¨æ˜¯ä¾èµ–ç¼“å­˜å»æ‰¾ç©å®¶çš„æˆ¿é—´ã€‚
å¹³æ—¶å·¥ä½œä¸­æ¥è§¦çš„å¤§éƒ¨åˆ†æ˜¯ redisï¼Œå¯¹ memcache ç›¸å¯¹äº†è§£è¾ƒå°‘ã€‚çœ‹äº†å®˜æ–¹æ–‡æ¡£åï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰¹é‡åˆ é™¤çš„æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰è·å–ä¸€ä¸ªå‰ç¼€æ‰€æœ‰ key çš„ç±»ä¼¼å‘½ä»¤ï¼Œæ‰€ä»¥æ‰¹é‡åˆ é™¤åªèƒ½å†™è„šæœ¬ã€‚
ç„¶åé—®é¢˜åˆæ¥äº†ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å“ªäº›ç©å®¶å¡åœ¨æˆ¿é—´é‡Œäº†ï¼Œå¦‚æœæ˜¯å…¨æœéå†ï¼Œæ˜æ˜¾ä¸å¯èƒ½ï¼Œå› ä¸ºæœ‰å¤§æ¦‚ 1000w çš„ç”¨æˆ·æ•°æ®ã€‚
æœ€åçš„æ–¹æ¡ˆï¼Œæ˜¯ä»æ•°æ®åº“æŸ¥è¯¢å¯¼å‡ºäº†æ‰€æœ‰å½“å¤©ç™»é™†è¿‡å¾—ç”¨æˆ·ï¼Œå¤§æ¦‚æ˜¯ 9w å¤šæ¡ï¼Œè¿˜èƒ½æ¥å—ã€‚
äºæ˜¯å†™äº†ä¸‹é¢çš„ go ç¨‹åºï¼š
mc := memcache.New("memcache.xxxxxxx.xxxxx.xxxx.com:11211") fmt.Println("memcache error:", mc.Ping()) time.Sleep(time.Second * 2) dealCount := 0 for _, v := range config.Records { key := "NOWSEVERID_" + v....</p></section><footer class=entry-footer>January 18, 2021&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;callous</footer><a class=entry-link aria-label="post link to è®°å½•ä¸€æ¬¡æ¸¸æˆæœåŠ¡ oom æŠ¢æ•‘" href=https://callous.cn/blog/tech/oom/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>2019æŠ“å–çˆ±å¥‡è‰ºè§†é¢‘åŸåœ°å€</h2></header><section class=entry-content><p>å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„ è®°å½•ä¸€ä¸‹è‡ªå·±åšè¿‡çš„äº‹å’Œå­¦è¿‡çš„ä¸œè¥¿ï¼Œå¸Œæœ›å¤§å®¶æŠ±ç€å­¦ä¹ çš„ç›®çš„æ¥æ¢è®¨ã€‚
è¿‡ç¨‹ å› ä¸ºæˆ‘å¯¹ç§»åŠ¨ç«¯çš„æ¶‰çŒå¹¶ä¸å¤šï¼Œæ‰€ä»¥è¿™æ¬¡è¿˜æ˜¯æ‹¿çˆ±å¥‡è‰ºçš„ç½‘ç«™æ¥ç ”ç©¶ã€‚é…åˆ chrome dev tools ï¼ˆçœŸå¥½ç”¨ï¼‰ï¼Œæˆ‘å‘ç°pcç«¯ç½‘é¡µé‡‡ç”¨äº†hlsåè®®ï¼Œè§†é¢‘è¢«åˆ‡æˆ 9 - 10 ç§’ï¼Œè¿™ä¸ªå¯ä»¥ç”¨ ffmpeg æ¥ä¸‹è½½åˆ—è¡¨è§†é¢‘ï¼Œç„¶ååˆæˆæ–‡ä»¶ã€‚å› ä¸ºæ¸¸æˆæœåŠ¡ç«¯çš„å¼€å‘å·¥ä½œï¼Œæˆ‘å¹¶æ²¡æœ‰å¾ˆå¤šç©ºé—²çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘è½¬è€Œç ”ç©¶äº†æ‰‹æœºç½‘é¡µç«¯ã€‚ä½†å…¶å®ä¸¤ä¸ªåˆ†æçš„æ€è·¯éƒ½å·®ä¸å¤šâ€¦â€¦..
å¼€å§‹ å…ˆæŠŠ chrome dev tools çš„æ¨¡å¼åˆ‡æ¢åˆ°æ‰‹æœºæ¨¡å¼ï¼Œç„¶åéšä¾¿ç‚¹è¿›ä¸€ä¸ªç”µè§†å‰§æˆ–è€…ç”µå½±çš„æ’­æ”¾é¡µé¢ï¼Œåˆ·æ–°ä¹‹åå¾ˆå®¹æ˜“æ‰¾åˆ°è¯·æ±‚è§†é¢‘åœ°å€çš„è¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™é‡Œå¤§æ¦‚åˆ—ä¸‹å‚æ•°ï¼Œå¤ªå¤šäº†ï¼Œä¸€äº›å¯ä»¥æ–­å®šçš„ã€å¯ä¸ºç©ºçš„æˆ–è€…ä¸å˜çš„æˆ‘å°±è·³è¿‡äº†ï¼ˆå¯ä»¥çœ‹ä¸‹é¢çš„jsä»£ç ï¼Œæœ‰äº›ç›´æ¥å°±å†™æ­»äº†ï¼‰ï¼š
tvid=2763030300 // ç”µè§†å‰§Id &vid=efa9e607d213c7bb066360f0005db9c6 // è§†é¢‘Id &bid=300 // è·Ÿæ¸…æ™°åº¦æœ‰å…³ ä¸‹åŒ &abid=300 // é«˜æ¸…æ˜¯300 æ¸…æ™°æ˜¯200 &src=02020031010000000000 // ä¸å˜ &uid=1150484048 // uid æˆ–ç©º &ut=1 // ä¸å˜ &ori=h5 // æ¥æº ä¸å˜ &ps=0 // ä¸å˜ &messageId=dash_445455783d1046029fef03f7c3ba0f9f &ost=0 ä¸å˜ &preIdAll= ä¸å˜ &locale=zh_cn ä¸å˜ &dfp=a0c99fd2610cf0473db8c0a7a62ac5a31577353dc9d69a44d2a164beb455ffa1fd // å¯ä¸ºç©º &k_tag=1 // ä¸å˜ &k_ft1=18141941858304 &k_ft5=1 // ä¸å˜ &k_err_retries=3 // ä¸å˜ &k_uid=uct4vh5s98nnnm00uxfwg73l // å¯ä¸ºéšæœº32ä½ String &pt=0 // ä¸å˜ &lid= // ä¸å˜ &cf= // ä¸å˜ &ct= // ä¸å˜ &ve=4d0345aec113399e2fc983530b36a907 &qd_v=2 // æš‚æ—¶ä¸å˜ &tm=1561334052647 // æ—¶é—´æˆ³ &qdy=a // ä¸å˜ &qds=0 // ä¸å˜ &vf=64adc57825317ca25c852960f19e3422 &callback=Z1561334031787 çœ‹äº†ä¸‹å¤§æ¦‚çš„å‚æ•°ï¼Œç„¶ååœ¨ chrome dev toolsçš„èµ„æºé¡µé¢æœç´¢äº†ä¸€ä¸‹å…³é”®å­— k_uidï¼Œå½“ç„¶æ˜¯æ··æ·†è¿‡çš„jsï¼Œè¿˜æ˜¯ä¸€è¡Œã€‚ ç”¨å·¥å…·è‡ªå¸¦çš„preety printåŠŸèƒ½åï¼Œç¨å¾®èƒ½çœ‹ä¸€ç‚¹ï¼ˆæ„Ÿè§‰chromeäº‹å…ˆéƒ½çŒœåˆ°äº†ä½ æƒ³è¦çš„æ‰€æœ‰ä¸œè¥¿ï¼‰ï¼Œè¿™é‡Œä¸Šå›¾ï¼š åˆ†æå‚æ•° ç°åœ¨æˆ‘ä»¬å‰©ä¸‹éœ€è¦åˆ†æçš„å‚æ•°æ˜¯ï¼šmessageId,k_ft1,ve å’Œä¸Šå›¾å‡½æ•°é‡Œæ²¡æœ‰åˆ—å‡ºçš„callbackå’Œvfï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥...</p></section><footer class=entry-footer>June 29, 2019&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;callous</footer><a class=entry-link aria-label="post link to 2019æŠ“å–çˆ±å¥‡è‰ºè§†é¢‘åŸåœ°å€" href=https://callous.cn/blog/tech/iqiyi/></a></article></main><footer class=footer><span>&copy; 2021 <a href=https://callous.cn>callous' blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top" accesskey=g><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${id}']`).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>